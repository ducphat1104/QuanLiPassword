const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Dashboard-m73n5tep.js","assets/ui-C_uF5axt.js","assets/vendor-Bz3rmKJE.js","assets/utils-D2tVOWfX.js","assets/BottomNavigation-CeuEuRIY.js","assets/ThemeToggle-DM9h1x9n.js","assets/router-Dp9ZVfyb.js","assets/charts-B7bDZ40n.js","assets/PageTransition-C1kLGRwo.js","assets/LoginPage-Dwqv3Edk.js","assets/AnimatedButton-DJoHrRdL.js","assets/RegisterPage-BcQG8Jh2.js","assets/TrashPage-D026mHp8.js","assets/ProfilePage-C_3DSRhZ.js"])))=>i.map(i=>d[i]);
import{j as e,m as t}from"./ui-C_uF5axt.js";import{a as s,r,R as a}from"./vendor-Bz3rmKJE.js";import{a as n,y as o,L as c}from"./utils-D2tVOWfX.js";import{u as i,B as l,R as d,a as u,N as m}from"./router-Dp9ZVfyb.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var h={},g=s;h.createRoot=g.createRoot,h.hydrateRoot=g.hydrateRoot;const p={},f=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),s=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));r=Promise.allSettled(t.map(e=>{if((e=function(e){return"/"+e}(e))in p)return;p[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${r}`))return;const a=document.createElement("link");return a.rel=t?"stylesheet":"modulepreload",t||(a.as="script"),a.crossOrigin="",a.href=e,s&&a.setAttribute("nonce",s),document.head.appendChild(a),t?new Promise((t,s)=>{a.addEventListener("load",t),a.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function a(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then(t=>{for(const e of t||[])"rejected"===e.status&&a(e.reason);return e().catch(a)})},x=r.createContext(),y="http://localhost:5000/api/auth",w=({children:t})=>{const[s,a]=r.useState(localStorage.getItem("token")),[c,i]=r.useState(null),[l,d]=r.useState(!0),u=e=>{e?(n.defaults.headers.common["x-auth-token"]=e,localStorage.setItem("token",e)):(delete n.defaults.headers.common["x-auth-token"],localStorage.removeItem("token"))};r.useEffect(()=>{(async()=>{const e=localStorage.getItem("token");if(e){u(e);try{const t=await n.get(`${y}/me`);i(t.data),a(e)}catch(t){u(null),a(null),i(null)}}d(!1)})()},[]),r.useEffect(()=>{let e;const t=()=>{clearTimeout(e),e=setTimeout(()=>{m(!0)},9e5)},r=["mousemove","mousedown","keypress","scroll","touchstart"];return s&&(r.forEach(e=>{window.addEventListener(e,t)}),t()),()=>{clearTimeout(e),r.forEach(e=>{window.removeEventListener(e,t)})}},[s]);const m=(e=!1)=>{const t=!!s;u(null),a(null),i(null),e&&t?o.warn("Bạn đã tự động đăng xuất do không hoạt động."):t&&o.info("Bạn đã đăng xuất.")};return e.jsx(x.Provider,{value:{token:s,user:c,loading:l,login:async(e,t)=>{var s,r;try{const s=await n.post(`${y}/login`,{username:e,password:t});u(s.data.token),a(s.data.token);const r=await n.get(`${y}/me`);i(r.data),o.success("Đăng nhập thành công!")}catch(c){o.error((null==(r=null==(s=c.response)?void 0:s.data)?void 0:r.msg)||"Đăng nhập thất bại")}},register:async(e,t)=>{var s,r;try{const s=await n.post(`${y}/register`,{username:e,password:t});u(s.data.token),a(s.data.token);const r=await n.get(`${y}/me`);i(r.data),o.success("Đăng ký thành công!")}catch(c){o.error((null==(r=null==(s=c.response)?void 0:s.data)?void 0:r.msg)||"Đăng ký thất bại")}},logout:m,setAuthToken:u,setUser:i},children:!l&&t})},v=r.createContext(),k=()=>{const e=r.useContext(v);if(!e)throw new Error("useTheme must be used within a ThemeProvider");return e},j=({children:t})=>{const[s,a]=r.useState(()=>{const e=localStorage.getItem("password-vault-theme");return e||(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")});r.useEffect(()=>{const e=document.documentElement;e.classList.remove("light","dark"),e.classList.add(s),localStorage.setItem("password-vault-theme",s);const t=document.querySelector('meta[name="theme-color"]');t&&t.setAttribute("content","dark"===s?"#1f2937":"#ffffff")},[s]),r.useEffect(()=>{const e=window.matchMedia("(prefers-color-scheme: dark)"),t=e=>{localStorage.getItem("password-vault-theme")||a(e.matches?"dark":"light")};return e.addEventListener("change",t),()=>e.removeEventListener("change",t)},[]);const n={theme:s,isDark:"dark"===s,isLight:"light"===s,toggleTheme:()=>{a(e=>"light"===e?"dark":"light")},setThemeMode:e=>{"light"!==e&&"dark"!==e||a(e)},resetToSystemTheme:()=>{localStorage.removeItem("password-vault-theme");const e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";a(e)}};return e.jsx(v.Provider,{value:n,children:t})},b=new Set,E=(e,t)=>`${e}-${t.slice(0,20).replace(/\s+/g,"-")}`,S={success:(e,t={})=>{const s=E("success",e);if(!b.has(s))return b.add(s),o.success(e,{toastId:s,onClose:()=>b.delete(s),...t})},error:(e,t={})=>{const s=E("error",e);if(!b.has(s))return b.add(s),o.error(e,{toastId:s,onClose:()=>b.delete(s),...t})},warning:(e,t={})=>{const s=E("warning",e);if(!b.has(s))return b.add(s),o.warning(e,{toastId:s,onClose:()=>b.delete(s),...t})},info:(e,t={})=>{const s=E("info",e);if(!b.has(s))return b.add(s),o.info(e,{toastId:s,onClose:()=>b.delete(s),...t})},custom:(e,t="info",s=null,r={})=>{const a=s||E(t,"custom");if(!b.has(a))return b.add(a),o[t](e,{toastId:a,onClose:()=>b.delete(a),...r})},dismiss:e=>{e?(b.delete(e),o.dismiss(e)):(b.clear(),o.dismiss())},dismissAll:()=>{b.clear(),o.dismiss()},dismissByType:e=>{const t=[];b.forEach(s=>{s.startsWith(e+"-")&&t.push(s)}),t.forEach(e=>{b.delete(e),o.dismiss(e)})},isActive:e=>b.has(e),getActiveToasts:()=>Array.from(b)},I=r.createContext(),P=()=>{const e=r.useContext(I);if(!e)throw new Error("useSecondaryPassword must be used within SecondaryPasswordProvider");return e},_=({children:t})=>{const[s,a]=r.useState(!1),[o,c]=r.useState(!1),[i,l]=r.useState(null),[d,u]=r.useState(30),[m,h]=r.useState(!0),g="http://localhost:5000",p=async()=>{try{const e=localStorage.getItem("token");if(!e)return void h(!1);const t=await n.get(`${g}/api/auth/secondary-password/settings`,{headers:{"x-auth-token":e}});a(t.data.enabled),u(t.data.rememberDuration||30)}catch(e){a(!1),u(30)}finally{h(!1)}},f=()=>{if(!s)return!0;const e=(new Date).getTime();return!!(i&&e<i)||(c(!1),l(null),!1)};r.useEffect(()=>{if(!s)return;const e=setInterval(()=>{f()},6e4);return()=>clearInterval(e)},[s,i]),r.useEffect(()=>{p()},[]);const x={isEnabled:s,isAuthenticated:o,expiresAt:i,rememberDuration:d,loading:m,checkSession:f,authenticate:async e=>{var t;try{const t=localStorage.getItem("token");if((await n.post(`${g}/api/auth/secondary-password/verify`,{password:e},{headers:{"x-auth-token":t}})).data.success){c(!0);const e=(new Date).getTime()+60*d*1e3;return l(e),S.success("Xác thực thành công!"),!0}return!1}catch(s){return 401===(null==(t=s.response)?void 0:t.status)?S.error("Mật khẩu cấp 2 không đúng"):S.error("Lỗi xác thực"),!1}},lock:()=>{c(!1),l(null),S.info("Đã khóa xem mật khẩu")},enable:async e=>{try{const t=localStorage.getItem("token");return!!(await n.post(`${g}/api/auth/secondary-password/enable`,{password:e,rememberDuration:d},{headers:{"x-auth-token":t}})).data.success&&(a(!0),S.success("Đã bật mật khẩu cấp 2"),!0)}catch(t){return S.error("Không thể bật mật khẩu cấp 2"),!1}},disable:async()=>{try{const e=localStorage.getItem("token");return!!(await n.post(`${g}/api/auth/secondary-password/disable`,{},{headers:{"x-auth-token":e}})).data.success&&(a(!1),c(!1),l(null),S.success("Đã tắt mật khẩu cấp 2"),!0)}catch(e){return S.error("Không thể tắt mật khẩu cấp 2"),!1}},updateRememberDuration:async e=>{try{const t=localStorage.getItem("token");return!!(await n.put(`${g}/api/auth/secondary-password/settings`,{rememberDuration:e},{headers:{"x-auth-token":t}})).data.success&&(u(e),S.success("Đã cập nhật cài đặt"),!0)}catch(t){return S.error("Không thể cập nhật cài đặt"),!1}},checkSettings:p};return e.jsx(I.Provider,{value:x,children:t})},L=()=>e.jsx(c,{position:"top-center",autoClose:4e3,hideProgressBar:!1,newestOnTop:!0,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,className:"custom-toast-container",toastClassName:"custom-toast",bodyClassName:"custom-toast-body",progressClassName:"custom-toast-progress"}),T=({size:s="md",text:r="Đang tải..."})=>{const a={sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12",xl:"w-16 h-16"},n={animate:{rotate:360,transition:{duration:1,repeat:1/0,ease:"linear"}}},o={animate:{scale:[1,1.1,1],opacity:[.7,1,.7],transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}}};return e.jsxs("div",{className:"flex flex-col items-center justify-center p-8",children:[e.jsxs("div",{className:"relative",children:[e.jsx(t.div,{className:`${a[s]} border-4 border-bg-tertiary rounded-full`,variants:o,animate:"animate"}),e.jsx(t.div,{className:`absolute inset-0 ${a[s]} border-4 border-transparent border-t-primary-custom rounded-full`,variants:n,animate:"animate"}),e.jsx(t.div,{className:"absolute inset-0 m-auto w-2 h-2 bg-primary-custom rounded-full",variants:o,animate:"animate"})]}),r&&e.jsx(t.p,{className:"mt-4 text-text-secondary text-sm font-medium",initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:r})]})},C=r.lazy(()=>f(()=>import("./Dashboard-m73n5tep.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),A=r.lazy(()=>f(()=>import("./LoginPage-Dwqv3Edk.js"),__vite__mapDeps([9,1,2,3,5,10,6]))),N=r.lazy(()=>f(()=>import("./RegisterPage-BcQG8Jh2.js"),__vite__mapDeps([11,1,2,3,5,10,6]))),$=r.lazy(()=>f(()=>import("./TrashPage-D026mHp8.js"),__vite__mapDeps([12,1,2,3,5,4,6,8]))),D=r.lazy(()=>f(()=>import("./ProfilePage-C_3DSRhZ.js"),__vite__mapDeps([13,1,2,3,4,5,6]))),O=({children:t})=>{const{token:s,loading:a}=r.useContext(x);return a?e.jsx("div",{children:"Loading..."}):s?t:e.jsx(m,{to:"/login"})},R=()=>{const{token:t}=r.useContext(x);return(()=>{const e=i();r.useEffect(()=>{S.dismiss()},[e.pathname])})(),e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"min-h-screen bg-bg-primary flex items-center justify-center",children:e.jsx(T,{})}),children:e.jsxs(d,{children:[e.jsx(u,{path:"/login",element:t?e.jsx(m,{to:"/"}):e.jsx(A,{})}),e.jsx(u,{path:"/register",element:t?e.jsx(m,{to:"/"}):e.jsx(N,{})}),e.jsx(u,{path:"/",element:e.jsx(O,{children:e.jsx(C,{})})}),e.jsx(u,{path:"/trash",element:e.jsx(O,{children:e.jsx($,{})})}),e.jsx(u,{path:"/profile",element:e.jsx(O,{children:e.jsx(D,{})})})]})})};function M(){return e.jsx(j,{children:e.jsx(w,{children:e.jsx(_,{children:e.jsx(l,{children:e.jsxs("div",{className:"App",children:[e.jsx(L,{}),e.jsx(R,{})]})})})})})}h.createRoot(document.getElementById("root")).render(e.jsx(a.StrictMode,{children:e.jsx(M,{})}));export{x as A,T as L,k as a,S as t,P as u};
