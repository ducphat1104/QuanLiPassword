import{j as e}from"./ui-C_uF5axt.js";import{r as t}from"./vendor-Bz3rmKJE.js";import{a as s,y as r}from"./utils-D2tVOWfX.js";import{A as a,t as n}from"./index-Dn1ZvxfH.js";import{D as i,g as c,E as o}from"./ThemeToggle-DM9h1x9n.js";import{H as d,B as l}from"./BottomNavigation-CeuEuRIY.js";import{P as x}from"./PageTransition-C1kLGRwo.js";import"./router-Dp9ZVfyb.js";const m="http://localhost:5000/api/passwords",h=()=>{const{token:h}=t.useContext(a),[g,p]=t.useState([]),[u,b]=t.useState(!0),y=async()=>{if(h){b(!0);try{const e=await s.get(`${m}/trash`,{headers:{"x-auth-token":h}});p(e.data.data)}catch(e){r.error("Không thể tải dữ liệu từ thùng rác.")}finally{b(!1)}}};t.useEffect(()=>{y()},[h]);const j=async e=>{try{n.dismiss(`permanent-delete-${e}`),n.dismiss("empty-trash-confirmation"),await s.put(`${m}/${e}/restore`,{},{headers:{"x-auth-token":h}}),n.success("Đã khôi phục mật khẩu thành công!"),y()}catch(t){n.error("Không thể khôi phục mật khẩu.")}},v=t=>{const s=`permanent-delete-${t}`;n.dismiss("empty-trash-confirmation"),n.custom(e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold mb-2",children:"Xóa vĩnh viễn?"}),e.jsx("p",{className:"text-sm mb-3",children:"Hành động này không thể hoàn tác. Bạn có chắc chắn?"}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx("button",{onClick:()=>{N(t),n.dismiss(s)},className:"bg-red-600 hover:bg-red-700 text-white font-bold py-1 px-3 rounded text-sm",children:"Xóa vĩnh viễn"}),e.jsx("button",{onClick:()=>n.dismiss(s),className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-1 px-3 rounded text-sm",children:"Hủy"})]})]}),"warning",s,{position:"top-center",autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1})},N=async e=>{try{await s.delete(`${m}/${e}/permanent`,{headers:{"x-auth-token":h}}),r.success("Đã xóa vĩnh viễn mật khẩu."),y()}catch(t){r.error("Không thể xóa vĩnh viễn mật khẩu.")}},f=async()=>{let e=0;const t=g.length,a=r.loading(`Đang xóa 0/${t}...`);for(const i of g)try{await s.delete(`${m}/${i._id}/permanent`,{headers:{"x-auth-token":h}}),e++,r.update(a,{render:`Đang xóa ${e}/${t}...`})}catch(n){r.error(`Lỗi khi xóa mật khẩu cho ${i.serviceName}.`)}r.update(a,{render:`Đã xóa ${e}/${t} mật khẩu.`,type:e===t?"success":"warning",isLoading:!1,autoClose:5e3}),y()};return e.jsx(x,{children:e.jsxs("div",{className:"bg-bg-secondary min-h-screen transition-colors duration-300",children:[e.jsx(d,{title:"Thùng rác",showBackButton:!0,backTo:"/"}),e.jsxs("div",{className:"container mx-auto p-6 pt-24 pb-20 md:pb-6",children:[u?e.jsx("p",{className:"text-center py-10 text-text-secondary",children:"Đang tải..."}):g.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block bg-card-bg rounded-lg shadow-custom overflow-hidden border border-border-primary",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-border-primary",children:[e.jsx("thead",{className:"bg-bg-tertiary",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Dịch vụ"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Tên đăng nhập"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider",children:"Ngày xóa"}),e.jsx("th",{scope:"col",className:"relative px-6 py-3",children:e.jsx("span",{className:"sr-only",children:"Actions"})})]})}),e.jsx("tbody",{className:"bg-card-bg divide-y divide-border-primary",children:g.map(t=>e.jsxs("tr",{className:"hover:bg-bg-tertiary transition-colors duration-200",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-text-primary",children:t.serviceName}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-text-secondary font-mono",children:t.username}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-text-secondary",children:new Date(t.deletedAt).toLocaleDateString("vi-VN")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsx("button",{onClick:()=>j(t._id),className:"text-text-tertiary hover:text-success-custom p-2 rounded-full transition-colors bg-bg-tertiary hover:bg-green-100 dark:hover:bg-green-900/20",title:"Khôi phục",children:e.jsx(i,{})}),e.jsx("button",{onClick:()=>v(t._id),className:"text-text-tertiary hover:text-danger-custom p-2 rounded-full transition-colors bg-bg-tertiary hover:bg-red-100 dark:hover:bg-red-900/20",title:"Xóa vĩnh viễn",children:e.jsx(c,{})})]})})]},t._id))})]})})}),e.jsx("div",{className:"md:hidden space-y-4",children:g.map(t=>e.jsxs("div",{className:"bg-card-bg rounded-lg shadow-custom border border-border-primary p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-sm font-medium text-text-primary truncate",children:t.serviceName}),e.jsx("p",{className:"text-xs text-text-secondary font-mono mt-1 break-all",children:t.username})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-3",children:[e.jsx("button",{onClick:()=>j(t._id),className:"text-text-tertiary hover:text-success-custom p-2 rounded-full transition-colors bg-bg-tertiary hover:bg-green-100 dark:hover:bg-green-900/20",title:"Khôi phục",children:e.jsx(i,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>v(t._id),className:"text-text-tertiary hover:text-danger-custom p-2 rounded-full transition-colors bg-bg-tertiary hover:bg-red-100 dark:hover:bg-red-900/20",title:"Xóa vĩnh viễn",children:e.jsx(c,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"text-xs text-text-tertiary",children:["Xóa ngày: ",new Date(t.deletedAt).toLocaleDateString("vi-VN")]})]},t._id))}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsxs("button",{onClick:()=>{if(0===g.length)return void r.info("Thùng rác trống!");const t="empty-trash-confirmation";n.dismissByType("warning"),n.custom(e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold mb-2",children:"Dọn sạch thùng rác?"}),e.jsxs("p",{className:"text-sm mb-3",children:["Toàn bộ ",g.length," mật khẩu sẽ bị xóa vĩnh viễn. Bạn có chắc chắn?"]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx("button",{onClick:()=>{f(),n.dismiss(t)},className:"bg-red-600 hover:bg-red-700 text-white font-bold py-1 px-3 rounded text-sm",children:"Dọn sạch"}),e.jsx("button",{onClick:()=>n.dismiss(t),className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-1 px-3 rounded text-sm",children:"Hủy"})]})]}),"warning",t,{position:"top-center",autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1})},className:"flex items-center gap-2 bg-danger-custom text-white py-2 px-4 rounded-lg hover:bg-red-600 transition-colors shadow-custom",children:[e.jsx(c,{}),e.jsx("span",{children:"Dọn sạch thùng rác"})]})})]}):e.jsxs("div",{className:"text-center py-10 px-6 bg-card-bg rounded-lg shadow-custom border border-border-primary",children:[e.jsx("div",{className:"flex justify-center items-center mx-auto w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full mb-4",children:e.jsx(c,{className:"text-3xl text-success-custom"})}),e.jsx("h2",{className:"text-xl font-semibold text-text-primary",children:"Thùng rác của bạn trống"}),e.jsx("p",{className:"text-text-secondary mt-2",children:"Các mật khẩu đã xóa sẽ xuất hiện ở đây trong 30 ngày."})]}),e.jsx("div",{className:"mt-8 p-4 bg-blue-50 dark:bg-blue-900/30 border-l-4 border-primary-custom rounded-r-lg",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"py-1",children:e.jsx(o,{className:"text-primary-custom mr-3",size:20})}),e.jsx("div",{children:e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:"Các mục trong thùng rác sẽ bị **xóa vĩnh viễn** sau 30 ngày. Hãy khôi phục nếu bạn cần."})})]})}),e.jsx(l,{})]})]})})};export{h as default};
