import{j as e,m as s}from"./ui-C_uF5axt.js";import{r as t}from"./vendor-Bz3rmKJE.js";import{z as r,a}from"./utils-D2tVOWfX.js";import{u as n,A as i,t as o}from"./index-Dn1ZvxfH.js";import{H as l,B as c}from"./BottomNavigation-CeuEuRIY.js";import{F as d,b as m,c as h,d as u,a as x,G as p,e as g,H as b,I as y,J as f,C as j,K as w,L as v,M as N}from"./ThemeToggle-DM9h1x9n.js";import"./router-Dp9ZVfyb.js";const k=({password:s,showDetails:t=!0})=>{if(!s)return null;const a=r(s),n=a.score,i=e=>{switch(e){case 0:return"bg-red-500";case 1:return"bg-orange-500";case 2:return"bg-yellow-500";case 3:return"bg-blue-500";case 4:return"bg-green-500";default:return"bg-gray-300"}},o=e=>({"This is a top-10 common password":"Đây là một trong 10 mật khẩu phổ biến nhất","This is a top-100 common password":"Đây là một trong 100 mật khẩu phổ biến nhất","This is a very common password":"Đây là mật khẩu rất phổ biến","This is similar to a commonly used password":"Mật khẩu này tương tự với các mật khẩu thường dùng","A word by itself is easy to guess":"Một từ đơn lẻ rất dễ đoán","Names and surnames by themselves are easy to guess":"Tên và họ riêng lẻ rất dễ đoán","Common names and surnames are easy to guess":"Tên và họ phổ biến rất dễ đoán","Straight rows of keys are easy to guess":"Các phím liên tiếp trên bàn phím rất dễ đoán","Short keyboard patterns are easy to guess":"Các mẫu bàn phím ngắn rất dễ đoán",'Repeats like "aaa" are easy to guess':'Các ký tự lặp lại như "aaa" rất dễ đoán','Repeats like "abcabcabc" are only slightly harder to guess than "abc"':'Các mẫu lặp như "abcabcabc" chỉ khó đoán hơn "abc" một chút',"Sequences like abc or 6543 are easy to guess":"Các chuỗi như abc hoặc 6543 rất dễ đoán","Recent years are easy to guess":"Các năm gần đây rất dễ đoán","Dates are often easy to guess":"Ngày tháng thường rất dễ đoán","Use a longer keyboard pattern with more turns":"Sử dụng mẫu bàn phím dài hơn với nhiều thay đổi hướng","Add another word or two. Uncommon words are better.":"Thêm một hoặc hai từ nữa. Từ không phổ biến sẽ tốt hơn.","Capitalization doesn't help very much":"Viết hoa không giúp ích nhiều","All-uppercase is almost as easy to guess as all-lowercase":"Toàn chữ hoa gần như dễ đoán bằng toàn chữ thường","Reversed words aren't much harder to guess":"Từ viết ngược không khó đoán hơn nhiều","Predictable substitutions like '@' instead of 'a' don't help very much":"Các thay thế dễ đoán như '@' thay vì 'a' không giúp ích nhiều","Avoid repeated words and characters":"Tránh lặp lại từ và ký tự","Avoid sequences":"Tránh các chuỗi tuần tự","Avoid recent years":"Tránh các năm gần đây","Avoid years that are associated with you":"Tránh các năm liên quan đến bạn","Avoid dates and years that are associated with you":"Tránh ngày tháng và năm liên quan đến bạn","No need for symbols, digits, or uppercase letters":"Không cần ký tự đặc biệt, số hoặc chữ hoa"}[e]||e);return e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"flex space-x-1 mb-2",children:[0,1,2,3,4].map(s=>e.jsx("div",{className:`h-2 flex-1 rounded ${s<=n?i(n):"bg-gray-200"}`},s))}),e.jsxs("div",{className:`text-sm font-medium ${(e=>{switch(e){case 0:return"text-red-600";case 1:return"text-orange-600";case 2:return"text-yellow-600";case 3:return"text-blue-600";case 4:return"text-green-600";default:return"text-gray-600"}})(n)}`,children:["Độ mạnh: ",(e=>{switch(e){case 0:return"Rất yếu";case 1:return"Yếu";case 2:return"Trung bình";case 3:return"Mạnh";case 4:return"Rất mạnh";default:return"Không xác định"}})(n)]}),t&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:[a.feedback.warning&&e.jsxs("div",{className:"text-orange-600 mb-1",children:["⚠️ ",o(a.feedback.warning)]}),a.feedback.suggestions.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"font-medium mb-1",children:"Gợi ý cải thiện:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:a.feedback.suggestions.map((s,t)=>e.jsx("li",{children:o(s)},t))})]}),a.crack_times_display&&e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"font-medium",children:"Thời gian bẻ khóa ước tính: "}),(e=>{const s={"less than a second":"ít hơn 1 giây",instant:"tức thì",seconds:"giây",minutes:"phút",hours:"giờ",days:"ngày",months:"tháng",years:"năm",centuries:"thế kỷ"};let t=e;return Object.keys(s).forEach(e=>{t=t.replace(new RegExp(e,"gi"),s[e])}),t})(a.crack_times_display.offline_slow_hashing_1e4_per_second)]})]})]})},C=()=>{const{isEnabled:r,rememberDuration:a,loading:i,enable:o,disable:l,updateRememberDuration:c}=n(),[b,y]=t.useState(!1),[f,j]=t.useState(""),[w,v]=t.useState(""),[N,k]=t.useState(!1),[C,P]=t.useState(!1),[T,S]=t.useState(a),[M,A]=t.useState(!1),[_,q]=t.useState({});return i?e.jsx("div",{className:"bg-card-bg rounded-2xl border border-border-primary p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-6 bg-bg-tertiary rounded w-1/3"}),e.jsx("div",{className:"h-4 bg-bg-tertiary rounded w-2/3"}),e.jsx("div",{className:"h-10 bg-bg-tertiary rounded"})]})}):e.jsxs("div",{className:"bg-card-bg rounded-2xl border border-border-primary overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary-custom/10 to-blue-500/10 p-6 border-b border-border-primary",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-primary-custom/20 rounded-lg",children:e.jsx(d,{className:"w-6 h-6 text-primary-custom"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary",children:"Mật Khẩu Cấp 2"}),e.jsx("p",{className:"text-sm text-text-secondary",children:"Thêm lớp bảo mật khi xem mật khẩu"})]})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 p-4 bg-bg-tertiary/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[e.jsx("div",{className:"p-2 rounded-lg flex-shrink-0 "+(r?"bg-green-100 dark:bg-green-900/30":"bg-gray-100 dark:bg-gray-800"),children:e.jsx(m,{className:"w-5 h-5 "+(r?"text-green-600":"text-gray-500")})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-medium text-text-primary",children:r?"Đã bật":"Đã tắt"}),e.jsx("p",{className:"text-sm text-text-secondary break-words",children:r?"Yêu cầu xác thực khi xem mật khẩu":"Không yêu cầu xác thực"})]})]}),e.jsx("div",{className:"flex justify-end sm:justify-start",children:r?e.jsx("button",{onClick:async()=>{A(!0),await l(),A(!1)},disabled:M,className:"px-6 py-2.5 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors duration-200 disabled:opacity-50 font-medium text-sm min-w-[80px]",children:M?"Đang tắt...":"Tắt"}):e.jsx("button",{onClick:()=>y(!0),disabled:M,className:"px-6 py-2.5 bg-primary-custom text-white rounded-lg hover:bg-primary-hover transition-colors duration-200 disabled:opacity-50 font-medium text-sm min-w-[80px]",children:"Bật"})})]}),b&&e.jsxs(s.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-4 border border-border-primary rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-text-primary",children:"Thiết lập mật khẩu cấp 2"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary",children:"Mật khẩu cấp 2"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:N?"text":"password",value:f,onChange:e=>{j(e.target.value),q({..._,password:""})},className:"w-full pr-10 py-3 px-3 bg-bg-tertiary border rounded-lg focus:ring-2 focus:ring-primary-custom focus:border-primary-custom transition-all duration-200 text-base "+(_.password?"border-red-500":"border-border-primary"),placeholder:"Nhập mật khẩu cấp 2"}),e.jsx("button",{type:"button",onClick:()=>k(!N),className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:N?e.jsx(h,{className:"w-4 h-4 text-text-tertiary"}):e.jsx(u,{className:"w-4 h-4 text-text-tertiary"})})]}),_.password&&e.jsx("p",{className:"text-sm text-red-500",children:_.password})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary",children:"Xác nhận mật khẩu"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:C?"text":"password",value:w,onChange:e=>{v(e.target.value),q({..._,confirmPassword:""})},className:"w-full pr-10 py-3 px-3 bg-bg-tertiary border rounded-lg focus:ring-2 focus:ring-primary-custom focus:border-primary-custom transition-all duration-200 text-base "+(_.confirmPassword?"border-red-500":"border-border-primary"),placeholder:"Nhập lại mật khẩu cấp 2"}),e.jsx("button",{type:"button",onClick:()=>P(!C),className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:C?e.jsx(h,{className:"w-4 h-4 text-text-tertiary"}):e.jsx(u,{className:"w-4 h-4 text-text-tertiary"})})]}),_.confirmPassword&&e.jsx("p",{className:"text-sm text-red-500",children:_.confirmPassword})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[e.jsxs("button",{onClick:()=>{y(!1),j(""),v(""),q({})},className:"flex-1 px-4 py-3 bg-bg-tertiary text-text-secondary rounded-lg hover:bg-text-tertiary hover:text-text-primary transition-all duration-200 flex items-center justify-center space-x-2 min-h-[44px]",children:[e.jsx(x,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Hủy"})]}),e.jsx("button",{onClick:async()=>{const e={...(e=>{const s={};return e?e.length<6&&(s.password="Mật khẩu phải có ít nhất 6 ký tự"):s.password="Vui lòng nhập mật khẩu",s})(f)};if(f!==w&&(e.confirmPassword="Mật khẩu xác nhận không khớp"),q(e),Object.keys(e).length>0)return;A(!0);await o(f)&&(y(!1),j(""),v(""),q({})),A(!1)},disabled:M,className:"flex-1 px-4 py-3 bg-primary-custom text-white rounded-lg hover:bg-primary-hover disabled:opacity-50 transition-all duration-200 flex items-center justify-center space-x-2 min-h-[44px]",children:M?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{className:"text-sm font-medium",children:"Đang thiết lập..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Bật mật khẩu cấp 2"})]})})]})]}),r&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{className:"w-5 h-5 text-text-secondary"}),e.jsx("h4",{className:"font-medium text-text-primary",children:"Thời gian nhớ"})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:[{value:5,label:"5 phút"},{value:15,label:"15 phút"},{value:30,label:"30 phút"},{value:60,label:"1 giờ"},{value:0,label:"Luôn hỏi"}].map(s=>e.jsx("button",{onClick:()=>(async e=>{S(e),r&&await c(e)})(s.value),className:"p-3 rounded-lg border transition-all duration-200 min-h-[48px] flex items-center justify-center "+(T===s.value?"border-primary-custom bg-primary-custom/10 text-primary-custom":"border-border-primary bg-bg-tertiary text-text-secondary hover:border-primary-custom/50"),children:e.jsx("div",{className:"text-sm font-medium text-center",children:s.label})},s.value))}),e.jsx("p",{className:"text-xs text-text-tertiary",children:0===T?"Sẽ hỏi mật khẩu cấp 2 mỗi lần xem mật khẩu":`Sau khi xác thực, sẽ không hỏi lại trong ${T} phút`})]})]})]})},P="http://localhost:5000/api/auth",T=()=>{const{user:s,token:r,setUser:n,logout:d}=t.useContext(i),[m,h]=t.useState(!1),[u,x]=t.useState({username:(null==s?void 0:s.username)||""}),[p,g]=t.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[T,S]=t.useState({current:!1,new:!1,confirm:!1}),M=e=>{S(s=>({...s,[e]:!s[e]}))};return e.jsxs("div",{className:"min-h-screen bg-bg-secondary transition-colors duration-300 pb-20 md:pb-0",children:[e.jsx(l,{title:"Cài đặt tài khoản",showBackButton:!0,backTo:"/"}),e.jsx("div",{className:"container mx-auto px-4 py-8 pt-24",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-card-bg rounded-lg shadow-custom p-6 border border-border-primary",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(b,{className:"text-primary-custom text-xl mr-3"}),e.jsx("h2",{className:"text-xl font-semibold text-text-primary",children:"Thông Tin Cá Nhân"})]}),e.jsxs("form",{onSubmit:async e=>{var s,t,i,l;if(e.preventDefault(),u.username.trim()){h(!0);try{const e=await a.put(`${P}/profile`,{username:u.username.trim()},{headers:{"x-auth-token":r}});e.data.success&&(n(e.data.user),o.success("Cập nhật thông tin thành công!"))}catch(c){(null==(t=null==(s=c.response)?void 0:s.data)?void 0:t.errors)?c.response.data.errors.forEach(e=>{o.error(e.msg)}):o.error((null==(l=null==(i=c.response)?void 0:i.data)?void 0:l.msg)||"Cập nhật thất bại")}finally{h(!1)}}else o.error("Username không được để trống")},children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Tên đăng nhập"}),e.jsx("input",{type:"text",value:u.username,onChange:e=>x({...u,username:e.target.value}),className:"w-full px-3 py-2 bg-input-bg border border-input-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-custom text-text-primary transition-colors duration-200",placeholder:"Nhập tên đăng nhập",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{type:"submit",disabled:m,className:"flex items-center px-4 py-2 bg-primary-custom text-white rounded-md hover:bg-primary-hover disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:[e.jsx(y,{className:"mr-2"}),m?"Đang lưu...":"Lưu thay đổi"]}),e.jsxs("button",{type:"button",onClick:()=>x({username:(null==s?void 0:s.username)||""}),className:"flex items-center px-4 py-2 bg-text-tertiary text-white rounded-md hover:bg-text-secondary transition-colors duration-200",children:[e.jsx(f,{className:"mr-2"}),"Hủy"]})]})]})]}),e.jsxs("div",{className:"bg-card-bg rounded-lg shadow-custom p-6 border border-border-primary",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(j,{className:"text-danger-custom text-xl mr-3"}),e.jsx("h2",{className:"text-xl font-semibold text-text-primary",children:"Đổi Mật Khẩu"})]}),e.jsxs("form",{onSubmit:async e=>{var s,t,n,i;if(e.preventDefault(),p.currentPassword&&p.newPassword&&p.confirmPassword)if(p.newPassword===p.confirmPassword)if(p.newPassword.length<6)o.error("Mật khẩu mới phải có ít nhất 6 ký tự");else{h(!0);try{(await a.put(`${P}/change-password`,{currentPassword:p.currentPassword,newPassword:p.newPassword},{headers:{"x-auth-token":r}})).data.success&&(g({currentPassword:"",newPassword:"",confirmPassword:""}),o.success("Đổi mật khẩu thành công!"))}catch(l){(null==(t=null==(s=l.response)?void 0:s.data)?void 0:t.errors)?l.response.data.errors.forEach(e=>{o.error(e.msg)}):o.error((null==(i=null==(n=l.response)?void 0:n.data)?void 0:i.msg)||"Đổi mật khẩu thất bại")}finally{h(!1)}}else o.error("Mật khẩu mới không khớp");else o.error("Vui lòng điền đầy đủ thông tin")},children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Mật khẩu hiện tại"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:T.current?"text":"password",value:p.currentPassword,onChange:e=>g({...p,currentPassword:e.target.value}),className:"w-full px-3 py-3 pr-12 bg-input-bg border border-input-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-custom text-text-primary transition-colors duration-200",placeholder:"Nhập mật khẩu hiện tại",required:!0}),e.jsx("button",{type:"button",onClick:()=>M("current"),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-text-tertiary hover:text-text-secondary transition-colors duration-200 p-1",children:T.current?e.jsx(w,{}):e.jsx(v,{})})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Mật khẩu mới"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:T.new?"text":"password",value:p.newPassword,onChange:e=>g({...p,newPassword:e.target.value}),className:"w-full px-3 py-3 pr-12 bg-input-bg border border-input-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-custom text-text-primary transition-colors duration-200",placeholder:"Nhập mật khẩu mới",required:!0}),e.jsx("button",{type:"button",onClick:()=>M("new"),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-text-tertiary hover:text-text-secondary transition-colors duration-200 p-1",children:T.new?e.jsx(w,{}):e.jsx(v,{})})]}),p.newPassword&&e.jsx(k,{password:p.newPassword,showDetails:!0})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Xác nhận mật khẩu mới"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:T.confirm?"text":"password",value:p.confirmPassword,onChange:e=>g({...p,confirmPassword:e.target.value}),className:"w-full px-3 py-3 pr-12 bg-input-bg border border-input-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-custom text-text-primary transition-colors duration-200",placeholder:"Nhập lại mật khẩu mới",required:!0}),e.jsx("button",{type:"button",onClick:()=>M("confirm"),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-text-tertiary hover:text-text-secondary transition-colors duration-200 p-1",children:T.confirm?e.jsx(w,{}):e.jsx(v,{})})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{type:"submit",disabled:m,className:"flex items-center px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(j,{className:"mr-2"}),m?"Đang đổi...":"Đổi mật khẩu"]}),e.jsxs("button",{type:"button",onClick:()=>g({currentPassword:"",newPassword:"",confirmPassword:""}),className:"flex items-center px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600",children:[e.jsx(f,{className:"mr-2"}),"Hủy"]})]})]})]})]}),e.jsx("div",{className:"mt-8",children:e.jsx(C,{})}),e.jsx("div",{className:"mt-8 bg-card-bg rounded-lg shadow-custom p-6 border border-border-primary",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-2",children:"Đăng xuất"}),e.jsx("p",{className:"text-text-secondary text-sm",children:"Đăng xuất khỏi tài khoản trên thiết bị này"})]}),e.jsxs("button",{onClick:()=>{const s="logout-confirmation";o.custom(e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("p",{className:"font-medium",children:"Bạn có chắc chắn muốn đăng xuất không?"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{d(),o.dismiss(s)},className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-medium transition-colors",children:"Đăng xuất"}),e.jsx("button",{onClick:()=>o.dismiss(s),className:"px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-700 rounded-lg text-sm font-medium transition-colors",children:"Hủy"})]})]}),"info",s,{autoClose:!1,closeOnClick:!1,draggable:!1,closeButton:!1})},className:"flex items-center justify-center gap-3 px-6 py-3 bg-red-500 hover:bg-red-600 text-white rounded-lg font-semibold transition-all duration-200 transform hover:scale-105 shadow-lg hover:shadow-xl w-full sm:w-auto",children:[e.jsx(N,{className:"text-lg"}),e.jsx("span",{children:"Đăng xuất"})]})]})})]})}),e.jsx(c,{})]})};export{T as default};
